#!/bin/bash
export CUBLAS_WORKSPACE_CONFIG=:4096:8
export PYTHONOPTIMIZE=1
githash=$(git rev-parse HEAD)
githash=${githash:0:7}

freeze_grad=null
save_dir=$1/freeze_grad_${freeze_grad}

python experiment.py Trainer.name=full Trainer.save_dir=$save_dir/$githash/fs_baseline Trainer.freeze_grad=${freeze_grad}

network_type=type1
python experiment.py Trainer.name=iterative Trainer.save_dir=$save_dir/$githash/arch_${network_type}/iteractive_1/detach_false Iterations.num_iter=1 Arch.detach=false Trainer.freeze_grad=${freeze_grad}
python experiment.py Trainer.name=iterative Trainer.save_dir=$save_dir/$githash/arch_${network_type}/iteractive_2/detach_false Iterations.num_iter=2 Arch.detach=false Trainer.freeze_grad=${freeze_grad}
python experiment.py Trainer.name=iterative Trainer.save_dir=$save_dir/$githash/arch_${network_type}/iteractive_3/detach_false Iterations.num_iter=3 Arch.detach=false Trainer.freeze_grad=${freeze_grad}
python experiment.py Trainer.name=iterative Trainer.save_dir=$save_dir/$githash/arch_${network_type}/iteractive_4/detach_false Iterations.num_iter=4 Arch.detach=false Trainer.freeze_grad=${freeze_grad}

python experiment.py Trainer.name=iterative Trainer.save_dir=$save_dir/$githash/arch_${network_type}/iteractive_1/detach_true Iterations.num_iter=1 Arch.detach=true Trainer.freeze_grad=${freeze_grad}
python experiment.py Trainer.name=iterative Trainer.save_dir=$save_dir/$githash/arch_${network_type}/iteractive_2/detach_true Iterations.num_iter=2 Arch.detach=true Trainer.freeze_grad=${freeze_grad}
python experiment.py Trainer.name=iterative Trainer.save_dir=$save_dir/$githash/arch_${network_type}/iteractive_3/detach_true Iterations.num_iter=3 Arch.detach=true Trainer.freeze_grad=${freeze_grad}
python experiment.py Trainer.name=iterative Trainer.save_dir=$save_dir/$githash/arch_${network_type}/iteractive_4/detach_true Iterations.num_iter=4 Arch.detach=true Trainer.freeze_grad=${freeze_grad}

network_type=type2
python experiment.py Trainer.name=iterative Trainer.save_dir=$save_dir/$githash/arch_${network_type}/iteractive_1/detach_false Iterations.num_iter=1 Arch.detach=false Trainer.freeze_grad=${freeze_grad}
python experiment.py Trainer.name=iterative Trainer.save_dir=$save_dir/$githash/arch_${network_type}/iteractive_2/detach_false Iterations.num_iter=2 Arch.detach=false Trainer.freeze_grad=${freeze_grad}
python experiment.py Trainer.name=iterative Trainer.save_dir=$save_dir/$githash/arch_${network_type}/iteractive_3/detach_false Iterations.num_iter=3 Arch.detach=false Trainer.freeze_grad=${freeze_grad}
python experiment.py Trainer.name=iterative Trainer.save_dir=$save_dir/$githash/arch_${network_type}/iteractive_4/detach_false Iterations.num_iter=4 Arch.detach=false Trainer.freeze_grad=${freeze_grad}

python experiment.py Trainer.name=iterative Trainer.save_dir=$save_dir/$githash/arch_${network_type}/iteractive_1/detach_true Iterations.num_iter=1 Arch.detach=true Trainer.freeze_grad=${freeze_grad}
python experiment.py Trainer.name=iterative Trainer.save_dir=$save_dir/$githash/arch_${network_type}/iteractive_2/detach_true Iterations.num_iter=2 Arch.detach=true Trainer.freeze_grad=${freeze_grad}
python experiment.py Trainer.name=iterative Trainer.save_dir=$save_dir/$githash/arch_${network_type}/iteractive_3/detach_true Iterations.num_iter=3 Arch.detach=true Trainer.freeze_grad=${freeze_grad}
python experiment.py Trainer.name=iterative Trainer.save_dir=$save_dir/$githash/arch_${network_type}/iteractive_4/detach_true Iterations.num_iter=4 Arch.detach=true Trainer.freeze_grad=${freeze_grad}
